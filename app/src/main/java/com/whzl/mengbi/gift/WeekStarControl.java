package com.whzl.mengbi.gift;import android.content.Context;import android.os.Handler;import android.view.View;import android.widget.RelativeLayout;import com.whzl.mengbi.R;import com.whzl.mengbi.chat.room.message.events.WeekHeadEvent;import com.whzl.mengbi.ui.widget.view.WeekStarView;import com.whzl.mengbi.util.WeakHandler;import java.io.IOException;import java.util.ArrayList;import java.util.List;import pl.droidsonroids.gif.AnimationListener;import pl.droidsonroids.gif.GifImageView;/** * @author nobody * @date 2018/11/5 */public class WeekStarControl implements AnimationListener {    RelativeLayout flEnter;    WeekStarView tvEnter;    GifImageView ivEnter;    Context context;    WeakHandler handler = new WeakHandler();    private Runnable runnable;    private pl.droidsonroids.gif.GifDrawable gifDrawable;    public WeekStarControl(Context context) {        this.context = context;    }    public void setIvEnter(GifImageView ivEnter) {        this.ivEnter = ivEnter;    }    public void setRlEnter(RelativeLayout llEnter) {        this.flEnter = llEnter;    }    public void setTvEnter(WeekStarView tvEnter) {        this.tvEnter = tvEnter;    }    private List<WeekHeadEvent> list = new ArrayList<>();    private boolean isPlay = false;    public void showEnter(WeekHeadEvent welcomeMsg) {        list.add(welcomeMsg);        if (!isPlay && list.size() != 0) {            startAnimal();        }    }    private void startAnimal() {        isPlay = true;        flEnter.setVisibility(View.VISIBLE);        WeekHeadEvent weekHeadEvent = list.get(0);        weekHeadEvent.init(tvEnter);        tvEnter.init();        try {            gifDrawable = new pl.droidsonroids.gif.GifDrawable(context.getResources(), R.drawable.bg_zhouxing);            gifDrawable.setLoopCount(1);            ivEnter.setImageDrawable(gifDrawable);            gifDrawable.addAnimationListener(this);        } catch (IOException e) {            e.printStackTrace();        }    }    private void outAnim() {        gifDrawable.reset();        if (list.size()>0) {            list.remove(0);        }        tvEnter.stopScroll();        tvEnter.setText("");        flEnter.setVisibility(View.GONE);        if (list.size() > 0) {            startAnimal();        } else {            isPlay = false;            flEnter.setVisibility(View.GONE);        }    }    public void destroy() {        handler.removeCallbacks(runnable);        list.clear();        if (tvEnter != null) {            tvEnter.setText("");            tvEnter.stopScroll();        }        isPlay = false;        if (gifDrawable != null) {            gifDrawable.stop();            gifDrawable.removeAnimationListener(this);            gifDrawable.reset();            ivEnter.setImageDrawable(null);        }        flEnter.setVisibility(View.GONE);    }    @Override    public void onAnimationCompleted(int loopNumber) {        tvEnter.startScroll();        runnable = () -> outAnim();        handler.postDelayed(runnable, 3000);    }}